# お弁当予約注文システム 仕様書

## 概要

本仕様書は、DDD（Domain-Driven Design）とneverthrowライブラリを使用した型安全なお弁当予約注文システムの詳細設計を記述しています。

## 仕様書の構成

### 1. アーキテクチャ
- [01. アーキテクチャ概要とエラー型定義](./01-architecture.md)
  - 原理原則
  - レイヤードアーキテクチャ
  - 依存パッケージ
  - エラー型の定義

### 2. ドメイン層
- [02. ドメインモデル設計](./02-domain-model.md)
  - エンティティ定義（User, Menu, Order）
  - 値オブジェクト（Money, OrderNumber）
  - Enum型定義

- [03. リポジトリインターフェース](./03-repositories.md)
  - IOrderRepository
  - IMenuRepository
  - IUserRepository
  - IOptionTemplateRepository

### 3. アプリケーション層
- [04. アプリケーションサービス](./04-application-services.md)
  - OrderService
  - UserService
  - neverthrowによるエラーハンドリング

- [06. バリデーション仕様](./06-validation.md)
  - Zodスキーマ定義
  - OrderValidator
  - MenuValidator

### 4. インフラストラクチャ層
- [05. インフラストラクチャ層実装](./05-infrastructure.md)
  - Supabaseリポジトリ実装
  - データベースアクセス層

- [10. データベーススキーマ](./10-database-schema.md)
  - テーブル定義
  - インデックス設計
  - RLSポリシー

### 5. プレゼンテーション層
- [08. プレゼンテーション層](./08-presentation.md)
  - コントローラー実装
  - APIエンドポイント

### 6. セキュリティ・認証
- [07. セキュリティ仕様](./07-security.md)
  - セッション管理
  - レート制限
  - 暗号化
  - CSRF対策

- [13. QRコード認証仕様](./13-qr-authentication.md)
  - QRコード認証フロー
  - 匿名セッション管理
  - APIエンドポイント詳細
  - セキュリティ対策

### 7. 管理機能
- [09. 管理者API仕様](./09-admin-api.md)
  - 注文集計
  - CSVエクスポート
  - メニュー管理

### 8. テスト・拡張性
- [11. テスト仕様](./11-testing.md)
  - ユニットテスト
  - Result型を使ったテスト

- [12. 拡張性の考慮](./12-extensibility.md)
  - インターフェース設計
  - 将来の拡張例

## 技術スタック

### コア技術
- **TypeScript** - 型安全な開発
- **neverthrow** - 関数型エラーハンドリング
- **Supabase** - バックエンドサービス
- **Zod** - バリデーションライブラリ

### アーキテクチャパターン
- **DDD (Domain-Driven Design)** - ドメイン駆動設計
- **レイヤードアーキテクチャ** - 責任の分離
- **Railway Oriented Programming** - 型安全なエラーハンドリング
- **Repository Pattern** - データアクセスの抽象化

## 設計原則

1. **型安全性** - すべてのエラーが型で表現される
2. **明示的なエラー処理** - try-catchを使わないResult型ベースの設計
3. **関心の分離** - レイヤードアーキテクチャによる責任の明確化
4. **依存性逆転原則** - インターフェースを通じた疎結合
5. **テスタビリティ** - 予測可能で保守性の高い設計

## ドキュメントの読み方

### 初めて読む方
1. まず [01. アーキテクチャ概要](./01-architecture.md) を読んで全体像を把握
2. [02. ドメインモデル設計](./02-domain-model.md) でビジネスロジックの中核を理解
3. 必要に応じて各層の詳細仕様を参照

### 実装者向け
- ドメイン層実装: 02, 03を参照
- アプリケーション層実装: 04, 06を参照
- インフラ層実装: 05, 10を参照
- API実装: 08, 09を参照
- 認証実装: 13を参照

### レビュアー向け
- アーキテクチャ確認: 01を参照
- セキュリティ確認: 07, 13を参照
- テスト方針確認: 11を参照

## 更新履歴

- 2025-11-17 - QRコード認証仕様を追加（13-qr-authentication.md）
- 2024-XX-XX - 仕様書を複数ファイルに分割
- 初版作成

## 関連ドキュメント

- [CLAUDE.md](../CLAUDE.md) - AI開発ガイド
- [README.md](../README.md) - プロジェクト概要
